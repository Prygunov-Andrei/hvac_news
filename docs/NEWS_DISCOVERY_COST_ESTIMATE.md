# Оценка затрат на разовый поиск новостей

## Параметры системы

- **Количество ресурсов:** 220
- **Основной провайдер:** Grok 4.1 Fast (xAI)
- **Резервный провайдер:** OpenAI GPT-5.2
- **Использование веб-поиска:** Да (встроен в модели)

## Анализ размера запросов

### Промпт (Input токены)
- Размер промпта: ~1,300 символов
- Примерная оценка токенов: **434 токена** на ресурс
- Для 220 ресурсов: **95,480 токенов**

### Ответ (Output токены)
- Размер ответа для 1 новости: ~1,067 символов = **355 токенов**
- Средний случай (5 новостей): **1,778 токенов** на ресурс
- Для 220 ресурсов: **391,160 токенов** (средний случай)

**Итого на 220 ресурсов:**
- Input: **95,480 токенов** (~95.5K)
- Output: **391,160 токенов** (~391K)
- **Всего: ~486,640 токенов** (~487K)

## Оценка стоимости

### Вариант 1: Grok 4.1 Fast (основной провайдер)

**Предполагаемые цены (на основе типичных цен xAI API):**
- Input: **$0.10** за 1M токенов
- Output: **$0.30** за 1M токенов

**Расчет:**
- Input: 95,480 / 1,000,000 * $0.10 = **$0.0095** (~$0.01)
- Output: 391,160 / 1,000,000 * $0.30 = **$0.117** (~$0.12)
- **Итого: ~$0.13** за разовый поиск по всем 220 ресурсам

### Вариант 2: OpenAI GPT-5.2 (резервный, если Grok недоступен)

**Предполагаемые цены (на основе цен GPT-4 и более новых моделей):**
- Input: **$5.00** за 1M токенов
- Output: **$15.00** за 1M токенов

**Расчет:**
- Input: 95,480 / 1,000,000 * $5.00 = **$0.48**
- Output: 391,160 / 1,000,000 * $15.00 = **$5.87**
- **Итого: ~$6.35** за разовый поиск по всем 220 ресурсам

### Вариант 3: Claude Sonnet 4.5 (Anthropic)

**Официальные цены ([Claude API Pricing](https://claude.com/pricing#api)):**
- Input (Prompts ≤ 200K tokens): **$3.00** за 1M токенов
- Output (Prompts ≤ 200K tokens): **$15.00** за 1M токенов
- Web search: **$10.00** за 1K поисков

**Расчет:**
- Input: 95,480 / 1,000,000 * $3.00 = **$0.29**
- Output: 391,160 / 1,000,000 * $15.00 = **$5.87**
- Web search: 220 поисков / 1,000 * $10.00 = **$2.20**
- **Итого: ~$8.36** за разовый поиск по всем 220 ресурсам

**Примечание:** Промпт (~434 токена) намного меньше 200K, поэтому используются цены для ≤ 200K tokens.

### Вариант 4: Claude Haiku 4.5 (Anthropic) - самый быстрый и экономичный от Claude

**Официальные цены ([Claude API Pricing](https://claude.com/pricing#api)):**
- Input: **$1.00** за 1M токенов
- Output: **$5.00** за 1M токенов
- Web search: **$10.00** за 1K поисков

**Расчет:**
- Input: 95,480 / 1,000,000 * $1.00 = **$0.10**
- Output: 391,160 / 1,000,000 * $5.00 = **$1.96**
- Web search: 220 поисков / 1,000 * $10.00 = **$2.20**
- **Итого: ~$4.26** за разовый поиск по всем 220 ресурсам

**Примечание:** Haiku 4.5 - самая быстрая и экономичная модель Claude, но все равно дороже Grok из-за платного веб-поиска.

## Сценарии использования

### Сценарий 1: Только Grok (успешные запросы)
- **Стоимость:** ~$0.13 за 220 ресурсов
- **Вероятность:** 90-95% (если Grok доступен)

### Сценарий 2: Grok + частичный fallback на OpenAI
- Предположим: 200 ресурсов через Grok, 20 через OpenAI
- Grok: 200 * ($0.01/220) = **$0.12**
- OpenAI: 20 * ($6.35/220) = **$0.58**
- **Итого: ~$0.70**

### Сценарий 3: Только OpenAI (если Grok полностью недоступен)
- **Стоимость:** ~$6.35 за 220 ресурсов

### Сценарий 4: Claude Sonnet 4.5 (альтернативный вариант)
- **Стоимость:** ~$8.36 за 220 ресурсов

### Сценарий 5: Claude Haiku 4.5 (самый экономичный от Claude)
- **Стоимость:** ~$4.26 за 220 ресурсов

## Ежедневные затраты (при ежедневном поиске)

- **Сценарий 1 (Grok):** $0.13 * 30 = **~$3.90/месяц**
- **Сценарий 2 (смешанный):** $0.70 * 30 = **~$21/месяц**
- **Сценарий 3 (только OpenAI):** $6.35 * 30 = **~$190.50/месяц**
- **Сценарий 4 (Claude Sonnet 4.5):** $8.36 * 30 = **~$250.80/месяц**
- **Сценарий 5 (Claude Haiku 4.5):** $4.26 * 30 = **~$127.80/месяц**

## Еженедельные затраты

- **Сценарий 1 (Grok):** $0.13 * 7 = **~$0.91/неделю**
- **Сценарий 2 (смешанный):** $0.70 * 7 = **~$4.90/неделю**
- **Сценарий 3 (только OpenAI):** $6.35 * 7 = **~$44.45/неделю**
- **Сценарий 4 (Claude Sonnet 4.5):** $8.36 * 7 = **~$58.52/неделю**
- **Сценарий 5 (Claude Haiku 4.5):** $4.26 * 7 = **~$29.82/неделю**

## Оптимизация затрат

### Рекомендации:

1. **Приоритет Grok:** Использовать Grok как основной провайдер (в 10-50 раз дешевле)
2. **Ограничение fallback:** Ограничить использование OpenAI fallback только критическими случаями
3. **Батчинг:** Группировать запросы для снижения overhead (если API поддерживает)
4. **Кэширование:** Кэшировать результаты для ресурсов, которые не обновляются часто
5. **Приоритизация:** Обрабатывать сначала наиболее важные ресурсы

### Потенциальная экономия:

- Если 50% ресурсов не требуют ежедневного обновления: **-50% затрат**
- Если использовать кэш для стабильных ресурсов: **-20-30% затрат**

## Примечания

⚠️ **Важно:** 
- Цены на Grok API могут отличаться от указанных (официальная документация xAI может иметь другие тарифы)
- GPT-5.2 - новая модель, точные цены могут отличаться
- Веб-поиск может добавлять дополнительную стоимость (если тарифицируется отдельно)
- Реальные затраты могут варьироваться в зависимости от:
  - Количества найденных новостей (влияет на размер output)
  - Длины найденных новостей
  - Ошибок API (повторные запросы)
  - Rate limits (задержки между запросами)

## Сравнительная таблица провайдеров

| Провайдер | Модель | Разовый поиск (220 ресурсов) | Месяц (30 дней) | Неделя (7 дней) |
|-----------|--------|------------------------------|-----------------|-----------------|
| **Grok** | 4.1 Fast | **~$0.13** | **~$3.90** | **~$0.91** |
| **Claude** | Haiku 4.5 | ~$4.26 | ~$127.80 | ~$29.82 |
| **OpenAI** | GPT-5.2 | ~$6.35 | ~$190.50 | ~$44.45 |
| **Claude** | Sonnet 4.5 | ~$8.36 | ~$250.80 | ~$58.52 |

**Разница в стоимости:**
- Grok дешевле Haiku 4.5 в **~33 раза**
- Grok дешевле OpenAI в **~49 раз**
- Grok дешевле Sonnet 4.5 в **~64 раза**
- Haiku 4.5 дешевле OpenAI на **~33%**
- Haiku 4.5 дешевле Sonnet 4.5 на **~49%**
- Sonnet 4.5 дороже OpenAI на **~32%** (из-за платного веб-поиска)

## Выводы

**Для разового поиска по 220 ресурсам:**
- **Минимальная стоимость (Grok):** ~$0.13
- **Claude Haiku 4.5:** ~$4.26
- **Средняя стоимость (OpenAI):** ~$6.35
- **Максимальная стоимость (Claude Sonnet 4.5):** ~$8.36
- **Реалистичная стоимость (смешанный Grok+OpenAI):** ~$0.70

**Рекомендации:**

1. **Основной провайдер: Grok 4.1 Fast** — самый экономичный вариант (~$0.13 за поиск)
   - В 49 раз дешевле OpenAI
   - В 64 раза дешевле Claude
   - Встроенный веб-поиск без дополнительной платы

2. **Резервный провайдер: OpenAI GPT-5.2** — использовать только при недоступности Grok
   - Средняя стоимость между Grok и Claude
   - Веб-поиск встроен в Responses API

3. **Альтернатива: Claude Haiku 4.5** — самый экономичный вариант от Claude
   - Дешевле OpenAI на ~33% (~$4.26 за поиск)
   - Дешевле Sonnet 4.5 на ~49%
   - Но все равно в 33 раза дороже Grok
   - Веб-поиск тарифицируется отдельно ($10/1K поисков = $2.20 для 220 ресурсов)
   - Подходит если нужна альтернатива Grok и качество Claude

4. **Альтернатива: Claude Sonnet 4.5** — не рекомендуется из-за высокой стоимости
   - Самый дорогой вариант (~$8.36 за поиск)
   - Веб-поиск тарифицируется отдельно ($10/1K поисков)
   - Подходит только если требуется высочайшее качество и есть бюджет

**Итоговая рекомендация:** 
- **Основной провайдер: Grok 4.1 Fast** — самый экономичный (~$0.13 за поиск)
- **Резервный провайдер: OpenAI GPT-5.2** — использовать только при недоступности Grok
- **Альтернатива: Claude Haiku 4.5** — если нужна альтернатива Grok и качество Claude, но в 33 раза дороже
- **Не рекомендуется: Claude Sonnet 4.5** — слишком дорого из-за платного веб-поиска
