# Задание для фронтенда: CRUD операции для Источников, Брендов и Производителей

## Общая информация

Реализован полный CRUD (Create, Read, Update, Delete) функционал для трех сущностей:
- **Источники новостей** (NewsResource)
- **Производители** (Manufacturer)
- **Бренды** (Brand)

Все операции доступны через REST API с поддержкой поиска и валидации.

## Цель задачи

Создать интерфейс для управления источниками, производителями и брендами с возможностью:
- Просмотра списков
- Создания новых записей
- Редактирования существующих записей
- Удаления записей
- Поиска связанных сущностей (производители при создании бренда, бренды при редактировании производителя)

## Аутентификация

**Важно:** Для операций создания, редактирования и удаления требуется аутентификация (JWT токен).

Операции чтения (list, retrieve) доступны всем пользователям.

## API эндпоинты

### 1. Производители (Manufacturers)

**Базовый URL:** `/api/manufacturers/`

#### Список производителей
- **Метод:** `GET /api/manufacturers/`
- **Аутентификация:** Не требуется
- **Параметры:**
  - `ordering=ranking_score` - сортировка по рейтингу (убывание)
  - `ordering=-ranking_score` - сортировка по рейтингу (возрастание)
  - `ordering=total_news` - сортировка по количеству новостей
  - `is_active=true` - только активные
  - `is_active=false` - только неактивные
- **Ответ:** Массив объектов `Manufacturer` с полями:
  ```json
  {
    "id": 1,
    "name": "Название производителя",
    "website_1": "https://example.com",
    "website_2": null,
    "website_3": null,
    "description": "Описание",
    "region": "Россия",
    "statistics": {...},
    "brands": [...],
    "brands_count": 5
  }
  ```

#### Получить производителя
- **Метод:** `GET /api/manufacturers/{id}/`
- **Аутентификация:** Не требуется
- **Ответ:** Объект `Manufacturer`

#### Создать производителя
- **Метод:** `POST /api/manufacturers/`
- **Аутентификация:** Требуется (JWT)
- **Тело запроса:**
  ```json
  {
    "name": "Название производителя",
    "website_1": "https://example.com",
    "website_2": "https://example2.com",
    "website_3": null,
    "description": "Описание",
    "region": "Россия"
  }
  ```
- **Валидация:**
  - `name` - обязательное, уникальное
  - `website_1`, `website_2`, `website_3` - опциональные, должны быть валидными URL
  - `description` - опциональное
  - `region` - опциональное

#### Обновить производителя
- **Метод:** `PUT /api/manufacturers/{id}/` или `PATCH /api/manufacturers/{id}/`
- **Аутентификация:** Требуется (JWT)
- **Тело запроса:** Аналогично созданию (PUT - все поля, PATCH - только измененные)

#### Удалить производителя
- **Метод:** `DELETE /api/manufacturers/{id}/`
- **Аутентификация:** Требуется (JWT)
- **Важно:** При удалении производителя удаляются все связанные бренды (каскадное удаление)

#### Поиск брендов для производителя
- **Метод:** `GET /api/manufacturers/search_brands/`
- **Аутентификация:** Не требуется
- **Параметры:**
  - `search` - строка поиска (поиск по названию бренда)
  - `manufacturer_id` - фильтр по производителю (опционально)
  - `limit` - ограничение количества результатов (по умолчанию 20)
- **Ответ:** Массив объектов `Brand`
- **Использование:** При редактировании производителя для поиска и добавления брендов

### 2. Бренды (Brands)

**Базовый URL:** `/api/brands/`

#### Список брендов
- **Метод:** `GET /api/brands/`
- **Аутентификация:** Не требуется
- **Ответ:** Массив объектов `Brand` с полями:
  ```json
  {
    "id": 1,
    "name": "Название бренда",
    "manufacturer": 1,
    "manufacturer_name": "Название производителя",
    "manufacturer_region": "Россия",
    "logo": null,
    "description": "Описание бренда"
  }
  ```

#### Получить бренд
- **Метод:** `GET /api/brands/{id}/`
- **Аутентификация:** Не требуется
- **Ответ:** Объект `Brand`

#### Создать бренд
- **Метод:** `POST /api/brands/`
- **Аутентификация:** Требуется (JWT)
- **Тело запроса:**
  ```json
  {
    "name": "Название бренда",
    "manufacturer": 1,
    "logo": null,
    "description": "Описание бренда"
  }
  ```
- **Валидация:**
  - `name` - обязательное, уникальное в рамках одного производителя
  - `manufacturer` - обязательное (ID производителя)
  - `logo` - опциональное (файл изображения)
  - `description` - опциональное

#### Обновить бренд
- **Метод:** `PUT /api/brands/{id}/` или `PATCH /api/brands/{id}/`
- **Аутентификация:** Требуется (JWT)
- **Тело запроса:** Аналогично созданию

#### Удалить бренд
- **Метод:** `DELETE /api/brands/{id}/`
- **Аутентификация:** Требуется (JWT)

#### Поиск производителей для бренда
- **Метод:** `GET /api/brands/search_manufacturers/`
- **Аутентификация:** Не требуется
- **Параметры:**
  - `search` - строка поиска (поиск по названию производителя или региону)
  - `limit` - ограничение количества результатов (по умолчанию 20)
- **Ответ:** Массив упрощенных объектов производителя:
  ```json
  [
    {
      "id": 1,
      "name": "Название производителя",
      "region": "Россия",
      "website_1": "https://example.com"
    }
  ]
  ```
- **Использование:** При создании/редактировании бренда для поиска производителя

### 3. Источники новостей (News Resources)

**Базовый URL:** `/api/resources/`

#### Список источников
- **Метод:** `GET /api/resources/`
- **Аутентификация:** Не требуется
- **Параметры:** Аналогично производителям (ordering, is_active)
- **Ответ:** Массив объектов `NewsResource` с полями:
  ```json
  {
    "id": 1,
    "name": "Название источника",
    "url": "https://example.com",
    "logo": null,
    "description": "Описание",
    "section": "Регион/Секция",
    "statistics": {...}
  }
  ```

#### Получить источник
- **Метод:** `GET /api/resources/{id}/`
- **Аутентификация:** Не требуется
- **Ответ:** Объект `NewsResource`

#### Создать источник
- **Метод:** `POST /api/resources/`
- **Аутентификация:** Требуется (JWT)
- **Тело запроса:**
  ```json
  {
    "name": "Название источника",
    "url": "https://example.com",
    "logo": null,
    "description": "Описание",
    "section": "Регион/Секция"
  }
  ```
- **Валидация:**
  - `name` - обязательное, уникальное
  - `url` - обязательное, должен начинаться с http:// или https://
  - `logo` - опциональное (файл изображения)
  - `description` - опциональное
  - `section` - опциональное

#### Обновить источник
- **Метод:** `PUT /api/resources/{id}/` или `PATCH /api/resources/{id}/`
- **Аутентификация:** Требуется (JWT)
- **Тело запроса:** Аналогично созданию

#### Удалить источник
- **Метод:** `DELETE /api/resources/{id}/`
- **Аутентификация:** Требуется (JWT)

## Требования к UI/UX

### Общие принципы

1. **Единообразие:**
   - Все три сущности должны иметь одинаковый стиль интерфейса
   - Единые паттерны для форм, списков, модальных окон

2. **Валидация на клиенте:**
   - Проверка обязательных полей перед отправкой
   - Валидация URL формата
   - Проверка уникальности (если возможно на клиенте)
   - Отображение ошибок валидации от сервера

3. **Обработка ошибок:**
   - Понятные сообщения об ошибках
   - Обработка сетевых ошибок
   - Обработка ошибок аутентификации (401, 403)

4. **Подтверждения:**
   - Подтверждение удаления (особенно для производителей с брендами)
   - Предупреждение о каскадном удалении

### Страница списка производителей

**Элементы:**
- Таблица со списком производителей
- Кнопка "Добавить производителя"
- Фильтры: по активности, сортировка
- Поиск по названию/региону
- Действия для каждой строки: Редактировать, Удалить

**При редактировании производителя:**
- Форма редактирования
- Секция "Бренды" с:
  - Список существующих брендов производителя
  - Кнопка "Добавить бренд"
  - Поиск брендов (через `search_brands`)
  - Возможность удалить бренд из списка

### Страница списка брендов

**Элементы:**
- Таблица со списком брендов
- Кнопка "Добавить бренд"
- Фильтры: по производителю
- Поиск по названию бренда
- Действия для каждой строки: Редактировать, Удалить

**При создании/редактировании бренда:**
- Форма с полями:
  - Название бренда (обязательное)
  - Производитель (обязательное) - **с поиском**
  - Логотип (загрузка файла)
  - Описание
- **Поиск производителя:**
  - Поле выбора производителя с автодополнением
  - При вводе текста - запрос к `/api/brands/search_manufacturers/?search={query}`
  - Отображение результатов в выпадающем списке
  - Возможность выбрать существующего или создать нового
  - Если создается новый - открывается форма создания производителя

### Страница списка источников

**Элементы:**
- Таблица со списком источников
- Кнопка "Добавить источник"
- Фильтры: по активности, сортировка
- Поиск по названию/URL
- Действия для каждой строки: Редактировать, Удалить

**При создании/редактировании источника:**
- Форма с полями:
  - Название (обязательное)
  - URL (обязательное, с валидацией)
  - Логотип (загрузка файла)
  - Описание
  - Секция/Регион

## Компоненты поиска

### Поиск производителей (для брендов)

**Компонент:** `ManufacturerSearchInput`

**Функциональность:**
- Поле ввода с автодополнением
- Задержка запроса (debounce) - не менее 300мс
- Отображение результатов в выпадающем списке
- Выбор производителя из списка
- Кнопка "Создать нового производителя"

**Пример использования:**
```javascript
<ManufacturerSearchInput
  value={selectedManufacturer}
  onChange={handleManufacturerChange}
  onCreateNew={() => openCreateManufacturerModal()}
  placeholder="Поиск производителя..."
/>
```

### Поиск брендов (для производителей)

**Компонент:** `BrandSearchInput`

**Функциональность:**
- Аналогично поиску производителей
- Фильтрация по производителю (если редактируется производитель)
- Возможность добавить найденный бренд к производителю

## Формы

### Общие требования к формам

1. **Валидация:**
   - Обязательные поля помечены звездочкой (*)
   - Валидация на blur и перед submit
   - Отображение ошибок под полями

2. **Загрузка файлов:**
   - Для логотипов (бренды, источники)
   - Превью загруженного изображения
   - Ограничение размера файла (рекомендуется до 5MB)
   - Поддерживаемые форматы: JPG, PNG, GIF, WebP

3. **Автосохранение (опционально):**
   - Автосохранение черновиков при редактировании
   - Восстановление при перезагрузке страницы

### Форма производителя

**Поля:**
- Название* (текст)
- Сайт 1 (URL)
- Сайт 2 (URL)
- Сайт 3 (URL)
- Описание (textarea)
- Регион (текст)

**Валидация:**
- Название: обязательное, минимум 2 символа
- URL: если указан, должен быть валидным

### Форма бренда

**Поля:**
- Название* (текст)
- Производитель* (поиск с автодополнением)
- Логотип (файл)
- Описание (textarea)

**Валидация:**
- Название: обязательное, минимум 2 символа
- Производитель: обязательный

### Форма источника

**Поля:**
- Название* (текст)
- URL* (текст, с валидацией URL)
- Логотип (файл)
- Описание (textarea)
- Секция/Регион (текст)

**Валидация:**
- Название: обязательное, минимум 2 символа
- URL: обязательное, должен начинаться с http:// или https://

## Модальные окна

### Модальное окно создания/редактирования

**Структура:**
- Заголовок ("Создать производителя" / "Редактировать производителя")
- Форма с полями
- Кнопки: "Отмена", "Сохранить"
- Индикатор загрузки при сохранении

### Модальное окно подтверждения удаления

**Структура:**
- Заголовок ("Подтверждение удаления")
- Текст предупреждения
- Для производителей: предупреждение о каскадном удалении брендов
- Кнопки: "Отмена", "Удалить"

**Пример текста для производителя:**
"Вы уверены, что хотите удалить производителя '{name}'? Все связанные бренды также будут удалены."

## Обработка ошибок

### Типы ошибок

1. **Ошибки валидации (400):**
   - Отображать под соответствующими полями
   - Формат: `{ "field_name": ["Ошибка валидации"] }`

2. **Ошибки аутентификации (401, 403):**
   - Показывать общее сообщение
   - Перенаправлять на страницу входа

3. **Ошибки сети:**
   - Показывать сообщение "Ошибка соединения"
   - Предлагать повторить попытку

4. **Ошибки сервера (500):**
   - Показывать общее сообщение об ошибке
   - Логировать для отладки

## Примеры запросов

### Создание производителя

```javascript
const createManufacturer = async (data) => {
  const response = await fetch('/api/manufacturers/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${jwtToken}`
    },
    body: JSON.stringify({
      name: 'Новый производитель',
      website_1: 'https://example.com',
      region: 'Россия',
      description: 'Описание'
    })
  });
  
  if (!response.ok) {
    const errors = await response.json();
    throw new Error(errors);
  }
  
  return await response.json();
};
```

### Поиск производителей

```javascript
const searchManufacturers = async (query) => {
  const response = await fetch(
    `/api/brands/search_manufacturers/?search=${encodeURIComponent(query)}&limit=20`
  );
  
  if (!response.ok) {
    throw new Error('Ошибка поиска');
  }
  
  return await response.json();
};
```

### Создание бренда с поиском производителя

```javascript
const createBrand = async (brandData, manufacturerId) => {
  const response = await fetch('/api/brands/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${jwtToken}`
    },
    body: JSON.stringify({
      name: brandData.name,
      manufacturer: manufacturerId,
      description: brandData.description
    })
  });
  
  if (!response.ok) {
    const errors = await response.json();
    throw new Error(errors);
  }
  
  return await response.json();
};
```

## Приоритеты реализации

**Высокий приоритет:**
1. CRUD операции для всех трех сущностей
2. Поиск производителей при создании бренда
3. Валидация форм
4. Обработка ошибок

**Средний приоритет:**
5. Поиск брендов при редактировании производителя
6. Загрузка логотипов
7. Подтверждения удаления

**Низкий приоритет:**
8. Автосохранение черновиков
9. Расширенная фильтрация
10. Экспорт данных

## Примечания

- Все операции создания/редактирования/удаления требуют JWT токен
- При удалении производителя автоматически удаляются все связанные бренды
- Поиск работает с задержкой (debounce) для оптимизации запросов
- Логотипы загружаются как файлы через FormData
- Статистика обновляется автоматически на бекенде, не требует ручного обновления

---

**Дата создания задания:** 2025-01-07  
**Версия API:** Текущая (все эндпоинты доступны)
