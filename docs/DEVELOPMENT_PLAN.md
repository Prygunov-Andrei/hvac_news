# План разработки проекта HVAC News

Данный план предполагает последовательную реализацию "Backend First". К каждому этапу приступаем только после полного завершения и тестирования предыдущего.

---

## Этап 1: Инициализация, База Данных и Пользователи

**Цель:** Развернуть проект, настроить базу данных PostgreSQL и реализовать систему аутентификации.

### 1.1. Backend (Python/Django)
1.  Инициализация Django проекта.
2.  Настройка подключения к PostgreSQL.
3.  Реализация кастомной модели пользователя (`User`):
    *   Поля: Email (логин), Имя, Флаг активности, Флаг администратора.
4.  Настройка JWT (JSON Web Token) аутентификации (библиотека `djangorestframework-simplejwt` или Djoser).
5.  Реализация API для регистрации, входа, получения данных профиля.

### 1.2. Система тестирования Backend
*   [ ] Unit-тесты на создание пользователя.
*   [ ] Тесты на уникальность email.
*   [ ] Тесты на получение и обновление токена.
*   [ ] Проверка прав доступа (доступ к профилю только у авторизованного).

### 1.3. Задание для Фронтенда (Этап 1)
**Задачи:**
1.  Настроить роутинг (Next.js / React Router).
2.  Создать страницу Входа (Login).
3.  Создать страницу Регистрации (Registration).
4.  Создать заглушку "Личный кабинет" (только для авторизованных).
5.  Реализовать хранение JWT токенов и их обновление.

**API Specification (v1):**

| Метод | URL | Описание | Тело запроса (Payload) |
| :--- | :--- | :--- | :--- |
| `POST` | `/api/auth/users/` | Регистрация | `{ "email": "...", "password": "...", "first_name": "..." }` |
| `POST` | `/api/auth/jwt/create/` | Получение токена (Логин) | `{ "email": "...", "password": "..." }` |
| `POST` | `/api/auth/jwt/refresh/` | Обновление токена | `{ "refresh": "..." }` |
| `GET` | `/api/auth/users/me/` | Данные текущего юзера | *Header: Authorization: Bearer <token>* |

### 1.4. Чек-лист тестирования Фронтенда (Этап 1)
*   [ ] Успешная регистрация перенаправляет на логин или сразу входит.
*   [ ] При вводе неверного пароля выводится понятная ошибка.
*   [ ] После входа токен сохраняется (localStorage/cookie), пользователь видит "Личный кабинет".
*   [ ] При обновлении страницы авторизация не слетает.
*   [ ] Кнопка "Выход" очищает токены и редиректит на главную.

---

## Этап 2: Справочники (Производители, Бренды, Ресурсы) и Мультиязычность

**Цель:** Реализовать статические разделы с поддержкой перевода.

### 2.1. Backend
1.  Настройка `django-modeltranslation` для поддержки 4 языков (RU, EN, DE, PT).
2.  Создание моделей:
    *   `Manufacturer` (Производитель).
    *   `Brand` (Бренд) — связь FK c Manufacturer.
    *   `NewsResource` (Новостной ресурс).
3.  Настройка Django Admin для удобного редактирования переводов полей (Tabs for languages).
4.  Реализация Read-Only API для вывода списков.

### 2.2. Система тестирования Backend
*   [ ] Тесты на создание объектов с переводами.
*   [ ] Тест API: запрос с заголовком `Accept-Language: en` возвращает английский контент.
*   [ ] Проверка фильтрации и связей (Бренд -> Производитель).

### 2.3. Задание для Фронтенда (Этап 2)
**Задачи:**
1.  Реализовать переключатель языков (в шапке сайта). Сохранять выбор языка.
2.  Страница "Производители": Таблица с группировкой по регионам.
3.  Страница "Бренды": Сетка/Таблица с логотипами.
4.  Страница "Полезные ресурсы".
5.  При смене языка контент должен обновляться без перезагрузки (или с ней).

**API Specification:**
*Все GET запросы поддерживают header `Accept-Language` (ru, en, de, pt)*

| Метод | URL | Описание | Особенности |
| :--- | :--- | :--- | :--- |
| `GET` | `/api/manufacturers/` | Список производителей | Должен возвращать nested list брендов внутри или ID брендов |
| `GET` | `/api/brands/` | Список брендов | Сортировка по алфавиту, поле `manufacturer` (expand) |
| `GET` | `/api/resources/` | Список ресурсов | |

### 2.4. Чек-лист тестирования Фронтенда (Этап 2)
*   [ ] Переключение языка меняет тексты в таблицах (название, описание).
*   [ ] Таблица производителей корректно отображает список брендов.
*   [ ] Ссылки на сайты производителей/ресурсов открываются в новой вкладке.
*   [ ] Корректное отображение картинок (логотипов).

---

## Этап 3: Ядро новостей (Parsing & Feed)

**Цель:** Реализовать загрузку .md файлов, обработку медиа и вывод новостной ленты.

### 3.1. Backend
1.  Создание модели `NewsPost`. Поля: дата публикации, переводимые заголовки/тексты.
2.  Разработка сервиса (Service Layer) для обработки загрузки:
    *   Принимает `.zip` (md + images) или папку.
    *   Парсит `.md` по спецификации (разбивает на языки).
    *   Сохраняет картинки/видео локально (`/media/news/<date>/`).
    *   Заменяет ссылки в тексте на локальные пути.
3.  Реализация "отложенной публикации" (фильтрация в ViewSet).
4.  API для новостной ленты с пагинацией.

### 3.2. Система тестирования Backend
*   [ ] Тест парсера: загрузка эталонного `.md` -> проверка записей в БД.
*   [ ] Тест обработки медиа: проверка, что файлы физически создались.
*   [ ] Тест отложенной публикации: пост из будущего не виден в API.

### 3.3. Задание для Фронтенда (Этап 3)
**Задачи:**
1.  Главная страница: Лента новостей.
2.  Компонент отображения новости (Markdown Renderer).
3.  Кастомные компоненты для Markdown: Видеоплеер, Галерея (если нужно), Изображение.
4.  Пагинация (Infinite scroll или кнопки "1, 2, 3").
5.  **Мультиязычность интерфейса (общая задача):**
    *   Все статические тексты (меню, кнопки) вынести в словари локализации.
    *   При смене языка подменять словари и отправлять заголовок `Accept-Language` к API.
    *   Сохранять выбранный язык в Cookies/LocalStorage.

**API Specification:**

| Метод | URL | Описание | Параметры |
| :--- | :--- | :--- | :--- |
| `GET` | `/api/news/` | Лента новостей | `?page=1`, `?limit=10` |
| `GET` | `/api/news/<id>/` | Детальная новость | |

### 3.4. Чек-лист тестирования Фронтенда (Этап 3)
*   [ ] Видео внутри новости проигрываются.
*   [ ] Картинки отображаются корректно.
*   [ ] Пагинация подгружает старые новости.
*   [ ] Новости из "будущего" не видны пользователю.
*   [ ] Переключение языка меняет контент новости (текст и заголовок).

---

## Этап 4: Социальные функции и Обратная связь

**Цель:** Комментарии и контактные формы.

### 4.1. Backend
1.  Модель `Comment`. Связь с `User` и `NewsPost`.
2.  API для CRUD комментариев (Создание, Чтение, Обновление своим автором, Удаление своим автором или админом).
3.  API endpoint `/feedback/`: Прием сообщения -> отправка Email админу (через SMTP Django).
4.  Интеграция Captcha (валидация на бэкенде).

### 4.2. Система тестирования Backend
*   [x] Пользователь не может редактировать чужой комментарий.
*   [x] Аноним не может оставить комментарий.
*   [x] Тест отправки email (mock email server).

### 4.3. Задание для Фронтенда (Этап 4)
**Задачи:**
1.  Блок комментариев под новостью.
2.  Форма добавления комментария (только для авторизованных).
3.  Кнопки "Ред./Удал." (видны только у своих комментариев).
4.  Модальное окно / Страница "Написать нам" с Капчей (ReCaptcha/hCaptcha).

**API Specification:**

| Метод | URL | Описание | Payload |
| :--- | :--- | :--- | :--- |
| `GET` | `/api/news/<id>/comments/` | Список комментов новости | |
| `POST` | `/api/comments/` | Создать коммент | `{ "news_id": 1, "text": "..." }` |
| `PATCH` | `/api/comments/<id>/` | Редактировать | `{ "text": "..." }` |
| `DELETE`| `/api/comments/<id>/` | Удалить | |
| `POST` | `/api/feedback/` | Обратная связь | `{ "email": "...", "message": "...", "captcha": "..." }` |

### 4.4. Чек-лист тестирования Фронтенда (Этап 4)
*   [ ] Незарегистрированный видит комменты, но не форму ввода.
*   [ ] После отправки комментария он появляется в списке (без перезагрузки или с ней).
*   [ ] Форма обратной связи не отправляется без капчи.

